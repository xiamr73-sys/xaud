C51 COMPILER V9.52.0.0   DMA                                                               12/02/2025 15:24:48 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE DMA
OBJECT MODULE PLACED IN .\Output\DMA.obj
COMPILER INVOKED BY: E:\tools\keil4\C51\BIN\C51.EXE ..\User\source\Hardware\DMA.c LARGE OMF2 WARNINGLEVEL(0) BROWSE FLOA
                    -TFUZZY(4) INCDIR(..\User\include;..\FU68xx_Haidware_Driver\Include) DEBUG PRINT(.\Listings\DMA.lst) TABS(2) OBJECT(.\Out
                    -put\DMA.obj)

line level    source

   1          /*  --------------------------- (C) COPYRIGHT 2020 Fortiortech ShenZhen -----------------------------
   2              File Name      : DMA.c
   3              Author         : Fortiortech  Appliction Team
   4              Version        : V1.0
   5              Date           : 2020-04-11
   6              Description    : This file contains .C file function used for Motor Control.
   7              ----------------------------------------------------------------------------------------------------
   8                                                 All Rights Reserved
   9              ------------------------------------------------------------------------------------------------- */
  10          #include "Myproject.h"
  11          
  12          #define Switch_DMA(a)     SetBit(*(&DMA0_CR0 + a), DMAEN | DMABSY)
  13          
  14          
  15          /*  ----------------------------------------------------------------------------------------------*/
  16          /*  Function Name  : SetPipe_DMA0
  17              /*  Description    : DMA0ÈÖçÁΩÆ
  18              /*  Date           : 2020-09-06
  19              /*  Parameter      : ePipe: [ËæìÂÖ•/Âá∫]
  20              /*  ----------------------------------------------------------------------------------------------*/
  21          void SetPipe_DMA0(eType_DMA_PIPE ePipe)
  22          {
  23   1          bool bTmp = false;
  24   1          
  25   1          if (ReadBit(DMA0_CR0, DMAEN))
  26   1          {
  27   2              bTmp = true;
  28   2              
  29   2              while (ReadBit(DMA0_CR0, DMABSY));
  30   2              
  31   2              ClrBit(DMA0_CR0, DMAEN);
  32   2          }
  33   1          
  34   1          SetReg(DMA0_CR0, DMACFG2 | DMACFG1 | DMACFG0, (int)ePipe);
  35   1          
  36   1          if (bTmp)
  37   1          {
  38   2              SetBit(DMA0_CR0, DMAEN);
  39   2          }
  40   1      }
  41          
  42          
  43          /*  ----------------------------------------------------------------------------------------------*/
  44          /*  Function Name  : SetPipe_DMA1
  45              /*  Description    : DMA1ÈÖçÁΩÆ
  46              /*  Date           : 2020-09-06
  47              /*  Parameter      : ePipe: [ËæìÂÖ•/Âá∫]
  48              /*  ----------------------------------------------------------------------------------------------*/
  49          void SetPipe_DMA1(eType_DMA_PIPE ePipe)
  50          {
  51   1          bool bTmp = false;
  52   1          
  53   1          if (ReadBit(DMA1_CR0, DMAEN))
C51 COMPILER V9.52.0.0   DMA                                                               12/02/2025 15:24:48 PAGE 2   

  54   1          {
  55   2              bTmp = true;
  56   2              
  57   2              while (ReadBit(DMA1_CR0, DMABSY));
  58   2              
  59   2              ClrBit(DMA1_CR0, DMAEN);
  60   2          }
  61   1          
  62   1          SetReg(DMA1_CR0, DMACFG2 | DMACFG1 | DMACFG0, (int)ePipe);
  63   1          
  64   1          if (bTmp)
  65   1          {
  66   2              SetBit(DMA1_CR0, DMAEN);
  67   2          }
  68   1      }
  69          
  70          
  71          /*  ----------------------------------------------------------------------------------------------*/
  72          /*  Function Name  : SetDataPackage_DMA0
  73              /*  Description    :  _DMA0
  74              /*  Date           : 2020-09-06
  75              /*  Parameter      : ulAddr: [ËæìÂÖ•/Âá∫]
  76          **           cLen: [ËæìÂÖ•/Âá∫]
  77              /*  ----------------------------------------------------------------------------------------------*/
  78          void SetDataPackage_DMA0(unsigned short ulAddr, char cLen)
  79          {
  80   1          bool bTmp = false;
  81   1          
  82   1          if (ReadBit(DMA0_CR0, DMAEN))
  83   1          {
  84   2              bTmp = true;
  85   2              
  86   2              while (ReadBit(DMA0_CR0, DMABSY));
  87   2              
  88   2              ClrBit(DMA0_CR0, DMAEN);
  89   2          }
  90   1          
  91   1          DMA0_LEN =  cLen;
  92   1          DMA0_BA  =  ulAddr;
  93   1          
  94   1          if (bTmp)
  95   1          {
  96   2              SetBit(DMA0_CR0, DMAEN);
  97   2          }
  98   1      }
  99          
 100          
 101          /*  ----------------------------------------------------------------------------------------------*/
 102          /*  Function Name  : SetDataPackage_DMA1
 103              /*  Description    : DMA1
 104              /*  Date           : 2020-09-06
 105              /*  Parameter      : ulAddr: [ËæìÂÖ•/Âá∫]
 106          **           cLen: [ËæìÂÖ•/Âá∫]
 107              /*  ----------------------------------------------------------------------------------------------*/
 108          void SetDataPackage_DMA1(unsigned short ulAddr, char cLen)
 109          {
 110   1          bool bTmp = false;
 111   1          
 112   1          if (ReadBit(DMA1_CR0, DMAEN))
 113   1          {
 114   2              bTmp = true;
 115   2              
C51 COMPILER V9.52.0.0   DMA                                                               12/02/2025 15:24:48 PAGE 3   

 116   2              while (ReadBit(DMA1_CR0, DMABSY));
 117   2              
 118   2              ClrBit(DMA1_CR0, DMAEN);
 119   2          }
 120   1          
 121   1          DMA1_LEN = cLen;
 122   1          DMA1_BA  = ulAddr;
 123   1          
 124   1          if (bTmp)
 125   1          {
 126   2              SetBit(DMA1_CR0, DMAEN);
 127   2          }
 128   1      }
 129          
 130          
 131          /*  ----------------------------------------------------------------------------------------------*/
 132          /*  Function Name  : SetEndian_DMA
 133              /*  Description    : DMA
 134              /*  Date           : 2020-09-06
 135              /*  Parameter      : eEndian: [ËæìÂÖ•/Âá∫]
 136              /*  ----------------------------------------------------------------------------------------------*/
 137          void SetEndian_DMA(eType_DMA_Endian eEndian)
 138          {
 139   1          bool bTmp = false, bTmp1 = false;
 140   1          
 141   1          if (ReadBit(DMA0_CR0, DMAEN))
 142   1          {
 143   2              bTmp = true;
 144   2              
 145   2              while (ReadBit(DMA0_CR0, DMABSY));
 146   2              
 147   2              ClrBit(DMA0_CR0, DMAEN);
 148   2          }
 149   1          
 150   1          if (ReadBit(DMA1_CR0, DMAEN))
 151   1          {
 152   2              bTmp1 = true;
 153   2              
 154   2              while (ReadBit(DMA1_CR0, DMABSY));
 155   2              
 156   2              ClrBit(DMA1_CR0, DMAEN);
 157   2          }
 158   1          
 159   1          SetReg(DMA0_CR0, ENDIAN, (int)eEndian);
 160   1          
 161   1          if (bTmp)
 162   1          {
 163   2              SetBit(DMA0_CR0, DMAEN);
 164   2          }
 165   1          
 166   1          if (bTmp1)
 167   1          {
 168   2              SetBit(DMA1_CR0, DMAEN);
 169   2          }
 170   1      }
 171          
 172          
 173          /*  ----------------------------------------------------------------------------------------------*/
 174          /*  Function Name  : SetIRQ_DMA
 175              /*  Description    : SetIRQ
 176              /*  Date           : 2020-09-06
 177              /*  Parameter      : eIRQ: [ËæìÂÖ•/Âá∫]
C51 COMPILER V9.52.0.0   DMA                                                               12/02/2025 15:24:48 PAGE 4   

 178          **           eIP: [ËæìÂÖ•/Âá∫]
 179              /*  ----------------------------------------------------------------------------------------------*/
 180          void SetIRQ_DMA(ebool eIRQ, eType_DMA_IRQ eIP)
 181          {
 182   1          SetReg(DMA0_CR0, DMAIE, eIRQ ? DMAIE : 0);
 183   1          
 184   1          if (!EA)
 185   1          {
 186   2              EA = true;
 187   2          }
 188   1          
 189   1          if (eIRQ)
 190   1          {
 191   2              SetReg(IP1, PDMA1 | PDMA0, (int)eIP);
 192   2          }
 193   1      }
 194          
 195          
 196          /*  ----------------------------------------------------------------------------------------------*/
 197          /*  Function Name  : SetDbgMod_DMA
 198              /*  Description    : SetDbgMod_DMA
 199              /*  Date           : 2020-09-06
 200              /*  Parameter      : None
 201              /*  ----------------------------------------------------------------------------------------------*/
 202          void SetDbgMod_DMA(void)
 203          {
 204   1          bool bTmp = false;
 205   1          
 206   1          if (ReadBit(DMA1_CR0, DMAEN))
 207   1          {
 208   2              bTmp = true;
 209   2              
 210   2              while (ReadBit(DMA1_CR0, DMABSY));
 211   2              
 212   2              ClrBit(DMA1_CR0, DMAEN);
 213   2          }
 214   1          
 215   1          SetBit(DMA1_CR0, DBGEN);
 216   1          SetBit(DMA1_CR0, ((int)DRAM_SPI));
 217   1          DMA1_LEN = 4;
 218   1          
 219   1          if (bTmp)
 220   1          {
 221   2              SetBit(DMA1_CR0, DMAEN);
 222   2          }
 223   1      }
 224          
 225          /*  ----------------------------------------------------------------------------------------------*/
 226          /*  Function Name  : Set_DBG_DMA
 227              /*  Description    : ËÆæÁΩÆDMA1ÁöÑDBGÊ®°Âºè
 228              /*  Date           : 2020-09-06
 229              /*  Parameter      : @param Addr   Ë¶ÅDBGËæìÂá∫ÁöÑÂú∞ÂùÄ
 230              /*  ----------------------------------------------------------------------------------------------*/
 231          void Set_DBG_DMA(uint16 DMAAddr)
 232          {
 233   1          ClrBit(DMA1_CR0, DMAEN);                                // Á¶ÅÊ≠¢DMA1‰º†Ëæì
 234   1          SetBit(DMA1_CR0, DBGEN | (int)DRAM_SPI);                     // ËÆæÁΩÆDMA1‰ΩøÁî®DBGÊ®°ÂºèÔºåXDATAÂèëÈÄ
             -ÅÊï∞ÊçÆÂà∞SPI
 235   1          
 236   1          if (!ReadBit(DMAAddr, 0x4000))
 237   1          {
 238   2              SetBit(DMA1_CR0, DBGSW);    //Ê†πÊçÆDMAAddrÂà§Êñ≠ÊòØÂê¶Âú®XRAMÂå∫ÔºåÂ¶ÇÊûúÊòØÂàôÂºÄÂêØDBGSW
C51 COMPILER V9.52.0.0   DMA                                                               12/02/2025 15:24:48 PAGE 5   

 239   2          }
 240   1          
 241   1          DMA1_LEN = 7;                                           // ËÆæÁΩÆDMA1ÂèëÈÄÅÊï∞Èáè‰∏∫8
 242   1          DMA1_BA = DMAAddr & 0x07ff;                             // ËÆæÁΩÆDMA1ÂèëÈÄÅÈ¶ñÂú∞ÂùÄ
 243   1          Switch_DMA(1);                                       // ÂêØÂä®DMA1
 244   1      }
 245          
 246          
 247          
 248          /*  ----------------------------------------------------------------------------------------------*/
 249          /*  Function Name  : SetDbgData_DMA
 250              /*  Description    : SetDbgData_DMA
 251              /*  Date           : 2020-09-06
 252              /*  Parameter      : ulAddr: [ËæìÂÖ•/Âá∫]
 253              /*  ----------------------------------------------------------------------------------------------*/
 254          void SetDbgData_DMA(unsigned short ulAddr)
 255          {
 256   1          bool bTmp = false;
 257   1          
 258   1          if (ReadBit(DMA1_CR0, DMAEN))
 259   1          {
 260   2              bTmp = true;
 261   2              
 262   2              while (ReadBit(DMA1_CR0, DMABSY));
 263   2              
 264   2              ClrBit(DMA1_CR0, DMAEN);
 265   2          }
 266   1          
 267   1          if (ulAddr <= 0xfff)
 268   1          {
 269   2              ulAddr += 0x70000000;
 270   2          }
 271   1          
 272   1          DMA1_BA = ulAddr;
 273   1          
 274   1          if (bTmp)
 275   1          {
 276   2              SetBit(DMA1_CR0, DMAEN);
 277   2          }
 278   1      }
 279          
 280          
 281          /*  ----------------------------------------------------------------------------------------------*/
 282          /*  Function Name  : EnableRun_DMA0
 283              /*  Description    : EnableRun_DMA0
 284              /*  Date           : 2020-09-06
 285              /*  Parameter      : None
 286              /*  ----------------------------------------------------------------------------------------------*/
 287          void EnableRun_DMA0(void)
 288          {
 289   1          SetBit(DMA0_CR0, DMAEN | DMABSY);
 290   1      }
 291          
 292          
 293          /*  ----------------------------------------------------------------------------------------------*/
 294          /*  Function Name  : EnableRun_DMA1
 295              /*  Description    : EnableRun_DMA1
 296              /*  Date           : 2020-09-06
 297              /*  Parameter      : None
 298              /*  ----------------------------------------------------------------------------------------------*/
 299          void EnableRun_DMA1(void)
 300          {
C51 COMPILER V9.52.0.0   DMA                                                               12/02/2025 15:24:48 PAGE 6   

 301   1          SetBit(DMA1_CR0, DMAEN | DMABSY);
 302   1      }
 303          
 304          
 305          /*  ----------------------------------------------------------------------------------------------*/
 306          /*  Function Name  : GetStatus_DMA0
 307              /*  Description    : GetStatus_DMA0
 308              /*  Date           : 2020-09-06
 309              /*  Parameter      : eStatu: [ËæìÂÖ•/Âá∫]
 310              /*  ----------------------------------------------------------------------------------------------*/
 311          bool GetStatus_DMA0(eType_DMA_Statu eStatu)
 312          {
 313   1          return ReadBit(DMA0_CR0, (int)eStatu);
 314   1      }
 315          
 316          
 317          /*  ----------------------------------------------------------------------------------------------*/
 318          /*  Function Name  : GetStatus_DMA1
 319              /*  Description    : GetStatus_DMA1
 320              /*  Date           : 2020-09-06
 321              /*  Parameter      : eStatu: [ËæìÂÖ•/Âá∫]
 322              /*  ----------------------------------------------------------------------------------------------*/
 323          bool GetStatus_DMA1(eType_DMA_Statu eStatu)
 324          {
 325   1          return ReadBit(DMA1_CR0, (int)eStatu);
 326   1      }
 327          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    505    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       8
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
